<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../img/favicon.ico">
        <title>install.py - PyPlate</title>
        <link href="../../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../../css/brands.min.css" rel="stylesheet">
        <link href="../../../css/solid.min.css" rel="stylesheet">
        <link href="../../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <link href="../../../assets/_mkdocstrings.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../../..">PyPlate</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../../.." class="nav-link">Home</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle active" aria-current="page" role="button" data-bs-toggle="dropdown"  aria-expanded="false">API</a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Bin</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../bin/pybaker/" class="dropdown-item">pybaker.py</a>
</li>
            
<li>
    <a href="../../bin/pymaker/" class="dropdown-item">pymaker.py</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Conf</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../conf/conf/" class="dropdown-item">conf.py</a>
</li>
            
<li>
    <a href="../../conf/mkdocs/" class="dropdown-item">mkdocs.py</a>
</li>
            
<li>
    <a href="../../conf/pdoc/" class="dropdown-item">pdoc.py</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Install</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="./" class="dropdown-item active" aria-current="page">install.py</a>
</li>
            
<li>
    <a href="../uninstall/" class="dropdown-item">uninstall.py</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Src</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../src/pybaker/" class="dropdown-item">pybaker.py</a>
</li>
            
<li>
    <a href="../../src/pymaker/" class="dropdown-item">pymaker.py</a>
</li>
            
<li>
    <a href="../../src/pyplate/" class="dropdown-item">pyplate.py</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../../conf/pdoc/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../uninstall/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#installpy" class="nav-link">install.py</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#install.install" class="nav-link">install</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#install.install.CNFormatter" class="nav-link">CNFormatter</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#install.install.CNInstall" class="nav-link">CNInstall</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="installpy">install.py</h1>


<div class="doc doc-object doc-module">



<a id="install.install"></a>
    <div class="doc doc-contents first">

        <p>The install script for this project</p>
<p>THis module installs the project, copying its files and folders to the
appropriate locations on the user's computer.</p>
<p>This file is real ugly b/c we can't access the venv, so we do it manually.</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="install.install.CNFormatter" class="doc doc-heading">
            <code>CNFormatter</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="argparse.RawTextHelpFormatter">RawTextHelpFormatter</span></code>, <code><span title="argparse.RawDescriptionHelpFormatter">RawDescriptionHelpFormatter</span></code></p>


        <p>A dummy class to combine multiple argparse formatters</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>RawTextHelpFormatter</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maintains whitespace for all sorts of help text,</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>RawDescriptionHelpFormatter</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Indicates that description and epilog are</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p>A dummy class to combine multiple argparse formatters.</p>







              <details class="quote">
                <summary>Source code in <code>install/install.py</code></summary>
                <pre class="highlight"><code class="language-python">class CNFormatter(
    argparse.RawTextHelpFormatter, argparse.RawDescriptionHelpFormatter
):
    """
    A dummy class to combine multiple argparse formatters

    Args:
        RawTextHelpFormatter: Maintains whitespace for all sorts of help text,
        including argument descriptions.
        RawDescriptionHelpFormatter: Indicates that description and epilog are
        already correctly formatted and should not be line-wrapped.

    A dummy class to combine multiple argparse formatters.
    """</code></pre>
              </details>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="install.install.CNInstall" class="doc doc-heading">
            <code>CNInstall</code>


</h2>


    <div class="doc doc-contents ">


        <p>The class to use for installing a PyPlate program</p>
<p>This class performs the install operation.</p>







              <details class="quote">
                <summary>Source code in <code>install/install.py</code></summary>
                <pre class="highlight"><code class="language-python">class CNInstall:
    """
    The class to use for installing a PyPlate program

    This class performs the install operation.
    """

    # --------------------------------------------------------------------------
    # Class constants
    # --------------------------------------------------------------------------

    # keys
    S_KEY_INST_NAME = "INST_NAME"
    S_KEY_INST_VER = "INST_VER"
    S_KEY_INST_DESK = "INST_DESK"
    S_KEY_INST_CONT = "INST_CONT"

    # short description
    # NB: MUST BE ALL ON ONE LINE!!!
    # I18N: short desc in installer
    S_PP_SHORT_DESC = _("foobar")

    # version string
    # NB: MUST BE ALL ON ONE LINE!!!
    S_PP_VERSION = "0.0.3"

    # debug option strings
    S_ARG_DRY_OPTION = "-d"
    S_ARG_DRY_ACTION = "store_true"
    S_ARG_DRY_DEST = "DRY_DEST"
    # I18N help string for debug cmd line option
    S_ARG_DRY_HELP = _("enable dry run mode")

    # config option strings
    S_ARG_HLP_OPTION = "-h"
    S_ARG_HLP_ACTION = "store_true"
    S_ARG_HLP_DEST = "HLP_DEST"
    # I18N: help option help
    S_ARG_HLP_HELP = _("show this help message and exit")

    # about string (to be set by subclass)
    S_ABOUT = (
        "\n"
        "PyPlate\n"
        f"{S_PP_SHORT_DESC}\n"
        f"{S_PP_VERSION}\n"
        "https://github.com/cyclopticnerve/PyPlate\n"
    )

    # I18N if using argparse, add help at end of about
    S_ABOUT_HELP = _("Use -h for help")

    # cmd line instructions string
    S_EPILOG = ""

    # --------------------------------------------------------------------------

    # messages

    # NB: format params are prog_name and prog_version
    # I18N: install the program
    S_MSG_INST_START = _("Installing {} Version {}")
    # NB: format param is prog_name
    # I18N: done installing
    S_MSG_INST_END = _("{} installed")
    # I18N: done with step
    S_MSG_DONE = _("Done")
    # I18N: step failed
    S_MSG_FAIL = _("Fail")
    # I18N: show the copy step
    S_MSG_COPY_START = _("Copying files... ")
    # I18N: show the venv step
    S_MSG_VENV_START = _("Making venv folder... ")
    # I18N: show the reqs step
    S_MSG_REQS_START = _("Installing requirements... ")
    # I18N: show desktop step
    S_MSG_DSK_START = _("Fixing .desktop file... ")
    # I18N: install aborted
    S_MSG_ABORT = _("Installation aborted")

    # questions

    # I18N: ask to overwrite same version
    S_ASK_VER_INST = _("The current version of this program will be installed.\nDo you want to continue? [Y/n] ")
    # I18N: ask to overwrite same version
    S_ASK_VER_SAME = _("The current version of this program is already installed.\nDo you want to overwrite? [y/N] ")
    # I18N: ask to overwrite newer version
    S_ASK_VER_OLDER = _("A newer version of this program is currently installed.\nDo you want to overwrite? [y/N] ")
    # I18N: confirm overwrite install
    S_ASK_CONFIRM = _("y")

    # errors

    # NB: format param is file path
    # I18N: config file not found
    S_ERR_NOT_FOUND = _("File {} not found")
    # NB: format param is file path
    # I18N: config file is not valid json
    S_ERR_NOT_JSON = _("File {} is not a JSON file")
    # I18N: version numbers invalid
    S_ERR_VERSION = _("One or both version numbers are invalid")
    # NB: format param is source path
    # I18N: src path invalid
    S_ERR_SRC_PATH = _("Source path can not be {}")
    # NB: format param is dest path
    # I18N: dst path invalid
    S_ERR_DST_PATH = _("Destination path can not be {}")

    # dry run messages

    S_DRY_VENV = "\nvenv cmd:"
    S_DRY_REQS = "\nreqs cmd:"
    # NB: format params are source and destination file/dir
    S_DRY_COPY = "\ncopy\n{}\nto\n{}"
    # NB: format param is path to icon
    S_DRY_DESK_ICON = "set desktop icon: {}"

    # commands

    # NB: format param is dir_venv
    S_CMD_CREATE = "python -m venv {}"
    # NB: format params are path to prj, path to venv, and path to reqs file
    S_CMD_INSTALL = "cd {};. {}/bin/activate;python -m pip install -r {}"

    # regex

    # regex to compare version numbers
    R_VERSION = r"(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(.*)$"
    R_VERSION_GROUP_MAJ = 1
    R_VERSION_GROUP_MIN = 2
    R_VERSION_GROUP_REV = 3

    # regex for adding user's home to icon path
    R_ICON_SCH = r"^(Icon=)(.*)$"
    R_ICON_REP = r"\g&lt;1&gt;{}"  # Icon=&lt;home/__PP_IMG_DESK__&gt;

    # --------------------------------------------------------------------------
    # Class methods
    # --------------------------------------------------------------------------

    # --------------------------------------------------------------------------
    # Initialize the class
    # --------------------------------------------------------------------------
    def __init__(self):
        """
        Initialize the class

        Creates a new instance of the object and initializes its properties.
        """

        # set arg properties
        self._dict_args = {}
        self._dry_run = False

        # project stuff
        # NB: set to path objects to avoid comparing to None
        self._dir_assets = Path()
        self._dir_usr_inst = Path()
        self._path_cfg_inst = Path()
        self._path_cfg_uninst = Path()
        self._dir_venv = Path()
        self._path_reqs = Path()
        self._file_desk = Path()
        self._file_desk_icon = Path()

        # config stuff
        self._dict_cfg = {}

        # cmd line stuff
        # NB: placeholder to avoid comparing to None
        self._parser = argparse.ArgumentParser()

    # --------------------------------------------------------------------------
    # Install the program
    # --------------------------------------------------------------------------
    def main(
        self,
        dir_assets,
        dir_usr_inst,
        path_cfg_inst,
        path_cfg_uninst,
        dir_venv,
        path_reqs,
        file_desk=None,
        file_desk_icon=None,
    ):
        """
        Install the program

        Args:
            dir_assets: Path to the assets folder where all of the program
            files are put in dist. This is the base source path to use when
            copying files to the user's computer
            dir_usr_inst: The program's install folder in which to place files
            path_cfg_inst: Path to the file that contains the current install
            dict info
            path_cfg_uninst: Path to the currently installed program's
            uninstall dict info
            dir_venv: The path to the venv folder to create
            path_reqs: Path to the requirements.txt file to add requirements to
            the venv
            file_desk: Path to the .desktop file (if GUI) (default: None)
            file_desk_icon: Path to the .desktop file icon (if GUI) (default:
            None)

        Runs the install operation.
        """

        # set props from params
        if dir_assets:
            dir_assets = Path(dir_assets)
            if not dir_assets.is_absolute():
                # make abs rel to self
                dir_assets = P_DIR_PRJ / dir_assets
        self._dir_assets = dir_assets

        if dir_usr_inst:
            dir_usr_inst = Path(dir_usr_inst)
            if not dir_usr_inst.is_absolute():
                # make abs rel to self
                dir_usr_inst = self._dir_assets / dir_usr_inst
        self._dir_usr_inst = dir_usr_inst

        if path_cfg_inst:
            path_cfg_inst = Path(path_cfg_inst)
            if not path_cfg_inst.is_absolute():
                # make abs rel to self
                path_cfg_inst = self._dir_assets / path_cfg_inst
        self._path_cfg_inst = path_cfg_inst

        if path_cfg_uninst:
            path_cfg_uninst = Path(path_cfg_uninst)
            if not path_cfg_uninst.is_absolute():
                # make abs rel to self
                path_cfg_uninst = self._dir_assets / path_cfg_uninst
        self._path_cfg_uninst = path_cfg_uninst

        if dir_venv:
            dir_venv = Path(dir_venv)
            if not dir_venv.is_absolute():
                # make abs rel to self
                dir_venv = self._dir_assets / dir_venv
        self._dir_venv = dir_venv

        if path_reqs:
            path_reqs = Path(path_reqs)
            if not path_reqs.is_absolute():
                # make abs rel to self
                path_reqs = self._dir_assets / path_reqs
        self._path_reqs = path_reqs

        if file_desk:
            file_desk = Path(file_desk)
            if not file_desk.is_absolute():
                # make abs rel to self
                file_desk = self._dir_assets / file_desk
        self._file_desk = file_desk

        if file_desk_icon:
            file_desk_icon = Path(file_desk_icon)
            if not file_desk_icon.is_absolute():
                # make abs rel to self
                file_desk_icon = self._dir_assets / file_desk_icon
        self._file_desk_icon = file_desk_icon

        # ----------------------------------------------------------------------

        # do setup
        self._setup()

        # parse cmd line and get args
        self._do_cmd_line()

        # get prj info from cfg
        self._get_project_info()

        # check for existing/old version
        self._check_ver()

        # make the venv on the user's comp
        self._make_venv()

        # install reqs
        self._install_reqs()

        # fix desktop file if present
        self._fix_desktop_file()

        # move content
        self._install_content()

        # wind down
        self._teardown()

    # --------------------------------------------------------------------------
    # Private methods
    # --------------------------------------------------------------------------

    # NB: these are the main steps, called in order from main()

    # --------------------------------------------------------------------------
    # Boilerplate to use at the start of main
    # --------------------------------------------------------------------------
    def _setup(self):
        """
        Boilerplate to use at the start of main

        Perform some mundane stuff like setting properties.
        """

        # print default about text
        print(self.S_ABOUT)

        # create a parser object in case we need it
        self._parser = argparse.ArgumentParser(
            add_help=False,
            epilog=self.S_EPILOG,
            formatter_class=CNFormatter,
        )

        # add help text to about block
        print(self.S_ABOUT_HELP)

        # add help option
        self._parser.add_argument(
            self.S_ARG_HLP_OPTION,
            dest=self.S_ARG_HLP_DEST,
            help=self.S_ARG_HLP_HELP,
            action=self.S_ARG_HLP_ACTION,
        )

        # add dry run option
        self._parser.add_argument(
            self.S_ARG_DRY_OPTION,
            dest=self.S_ARG_DRY_DEST,
            help=self.S_ARG_DRY_HELP,
            action=self.S_ARG_DRY_ACTION,
        )

    # --------------------------------------------------------------------------
    # Parse the arguments from the command line
    # --------------------------------------------------------------------------
    def _do_cmd_line(self):
        """
        Parse the arguments from the command line

        Parse the arguments from the command line, after the parser has been
        set up.
        """

        # get namespace object
        args = self._parser.parse_args()

        # convert namespace to dict
        self._dict_args = vars(args)

        # if -h passed, this will print and exit
        if self._dict_args.get(self.S_ARG_HLP_DEST, False):
            self._parser.print_help()
            sys.exit()

        # no -h, print epilog
        print(self.S_EPILOG)

        # ----------------------------------------------------------------------

        # get the args
        self._dry_run = self._dict_args.get(self.S_ARG_DRY_DEST, False)

    # --------------------------------------------------------------------------
    # Get project info
    # --------------------------------------------------------------------------
    def _get_project_info(self):
        """
        Get project info

        Get the install info from the config file.
        """

        # get project info
        self._dict_cfg = self._get_dict_from_file(self._path_cfg_inst)

        # get prg name/version
        prog_name = self._dict_cfg[self.S_KEY_INST_NAME]
        prog_version = self._dict_cfg[self.S_KEY_INST_VER]

        # print start msg
        print(self.S_MSG_INST_START.format(prog_name, prog_version))

    # --------------------------------------------------------------------------
    # Check version info
    # --------------------------------------------------------------------------
    def _check_ver(self):
        """
        Check version info

        Get the version info from the new config file and the old config file
        (if present), compare the two values, and either continue or abort.
        """

        # if we did pass an old conf, it must exist (if it doesn't, this could
        # be the first install but we will want to check on later updates)
        if self._path_cfg_uninst and Path(self._path_cfg_uninst).exists():

            # get info from old cfg
            dict_cfg_old = self._get_dict_from_file(self._path_cfg_uninst)

            # check versions
            ver_old = dict_cfg_old[self.S_KEY_INST_VER]
            ver_new = self._dict_cfg[self.S_KEY_INST_VER]
            res = self._do_compare_versions(ver_old, ver_new)

            # same version is installed
            if res == 0:

                # ask to install same version
                str_ask = input(self.S_ASK_VER_SAME)

                # user hit enter or typed anything else except "y"
                if (
                    len(str_ask) == 0
                    or str_ask.lower()[0] != self.S_ASK_CONFIRM
                ):
                    print(self.S_MSG_ABORT)
                    sys.exit()

            # newer version is installed
            elif res == -1:

                # ask to install old version over newer
                str_ask = input(self.S_ASK_VER_OLDER)

                # user hit enter or typed anything else except "y"
                if (
                    len(str_ask) == 0
                    or str_ask.lower()[0] != self.S_ASK_CONFIRM
                ):
                    print(self.S_MSG_ABORT)
                    sys.exit()

        # fresh install
        else:

            # ask to install old version over newer
            str_ask = input(self.S_ASK_VER_INST)

            # user hit "y" or "Enter"
            if len(str_ask) == 0 or str_ask.lower()[0] == self.S_ASK_CONFIRM:
                pass
            else:
                print(self.S_MSG_ABORT)
                sys.exit()

    # --------------------------------------------------------------------------
    # Make venv for this program on user's computer
    # --------------------------------------------------------------------------
    def _make_venv(self):
        """
        Make venv for this program on user's computer

        Raises:
            subprocess.CalledProcessError if the venv creation fails

        Makes a .venv-XXX folder on the user's computer.
        """

        # show progress
        print(self.S_MSG_VENV_START, flush=True, end="")

        # the command to create a venv
        cmd = self.S_CMD_CREATE.format(self._dir_venv)

        # if it's a dry run, don't make venv
        if self._dry_run:
            print(self.S_DRY_VENV, cmd)
            print(self.S_MSG_DONE)
            return

        # the cmd to create the venv
        try:
            subprocess.run(cmd, shell=True, check=True)
            print(self.S_MSG_DONE)
        except Exception as e:
            print(self.S_MSG_FAIL)
            raise e

    # --------------------------------------------------------------------------
    # Install requirements.txt
    # --------------------------------------------------------------------------
    def _install_reqs(self):
        """
        Install requirements.txt

        Raises:
            subprocess.CalledProcessError if the reqs install fails

        Installs the contents of a requirements.txt file into the program's
        venv.
        """

        # show progress
        print(self.S_MSG_REQS_START, end="", flush=True)

        # the command to install packages to venv from reqs
        cmd = self.S_CMD_INSTALL.format(
            self._dir_venv.parent, self._dir_venv.name, self._path_reqs
        )

        # if it's a dry run, don't install
        if self._dry_run:
            print(self.S_DRY_REQS, cmd)
            print(self.S_MSG_DONE)
            return

        # the cmd to install the reqs
        try:
            # NB: hide output
            subprocess.run(
                cmd, shell=True, check=True, stdout=subprocess.DEVNULL
            )
            print(self.S_MSG_DONE)
        except Exception as e:
            print(self.S_MSG_FAIL)
            raise e

    # --------------------------------------------------------------------------
    # Fix .desktop file, for paths and such
    # --------------------------------------------------------------------------
    def _fix_desktop_file(self):
        """
        Fix .desktop file, for paths and such

        Raises:
            OSError if one of both of the files does not exist

        Fixes entries in the .desktop file (absolute paths, etc.)
        Currently only fixes absolute path to icon.
        """

        # make sure we even care about desktop
        use_desk = self._dict_cfg.get(self.S_KEY_INST_DESK, False)
        if not use_desk:
            return

        # check both files for None and exist
        if not self._file_desk or not self._file_desk.exists():
            raise OSError(self.S_ERR_NOT_FOUND.format(self._file_desk))
        if not self._file_desk_icon or not self._file_desk_icon.exists():
            raise OSError(self.S_ERR_NOT_FOUND.format(self._file_desk_icon))

        # print info
        print(self.S_MSG_DSK_START, end="", flush=True)

        # don't mess with file
        if self._dry_run:
            print(self.S_DRY_DESK_ICON.format(self._file_desk_icon))
            print(self.S_MSG_DONE)
            return

        # open file
        text = ""
        with open(self._file_desk, "r", encoding="UTF-8") as a_file:
            text = a_file.read()

        # find icon line and fix
        res = re.search(self.R_ICON_SCH, text, flags=re.M)
        if res:

            # get user's home and path to icon rel to prj
            path_icon = Path.home() / self._file_desk_icon

            # fix abs path to icon
            r_icon_rep = self.R_ICON_REP.format(path_icon)
            text = re.sub(self.R_ICON_SCH, r_icon_rep, text, flags=re.M)

            # ------------------------------------------------------------------

            # write fixed text back to file
            with open(self._file_desk, "w", encoding="UTF-8") as a_file:
                a_file.write(text)

        # show some info
        print(self.S_MSG_DONE)

    # --------------------------------------------------------------------------
    # Copy source files/folders
    # --------------------------------------------------------------------------
    def _install_content(self):
        """
        Copy source files/folders

        This method copies files and folders from the assets folder of the
        source to their final locations in the user's folder structure.
        """

        # show some info
        print(self.S_MSG_COPY_START, flush=True, end="")

        # content list from dict
        content = self._dict_cfg.get(self.S_KEY_INST_CONT, {})

        # for each key, value
        for k, v in content.items():

            # get full paths of source / destination
            src = self._dir_assets / k
            dst = Path.home() / v / src.name

            # debug may omit certain assets
            if not src.exists():
                continue

            # check for dry run
            if self._dry_run:
                print(self.S_DRY_COPY.format(src, dst))
            else:
                # if the source is a dir
                if src.is_dir():
                    shutil.copytree(src, dst, dirs_exist_ok=True)
                # if the src is a file
                else:
                    shutil.copy(src, dst)

        # show some info
        print(self.S_MSG_DONE)

    # --------------------------------------------------------------------------
    # Boilerplate to use at the end of main
    # --------------------------------------------------------------------------
    def _teardown(self):
        """
        Boilerplate to use at the end of main

        Perform some mundane stuff like saving config files.
        """

        # just show we are done
        prog_name = self._dict_cfg[self.S_KEY_INST_NAME]
        print(self.S_MSG_INST_END.format(prog_name))

    # --------------------------------------------------------------------------
    # These are the minor steps, called from major steps for support
    # --------------------------------------------------------------------------

    # --------------------------------------------------------------------------
    # Get a dict from a file
    # --------------------------------------------------------------------------
    def _get_dict_from_file(self, a_file):
        """
        Get a dict from a file

        Args:
            a_file: The file to load the dict from

        Raises:
            OSError if the file cannot be found or is not a valid JSON file

        Returns:
            The dict found in the file

        Get a dict from a file, checking if the file exists and is a valid JSON
        file

        """
        # default result
        a_dict = {}

        # get dict from file
        try:
            with open(a_file, "r", encoding="UTF-8") as a_file:
                a_dict = json.load(a_file)

        # file not found
        except FileNotFoundError as e:
            raise OSError(self.S_ERR_NOT_FOUND.format(a_file)) from e

        # not valid json in file
        except json.JSONDecodeError as e:
            raise OSError(self.S_ERR_NOT_JSON.format(a_file)) from e

        # return result
        return a_dict

    # --------------------------------------------------------------------------
    # Compare two version strings for relativity
    # --------------------------------------------------------------------------
    def _do_compare_versions(self, ver_old, ver_new):
        """
        Compare two version strings for relativity

        Args:
            ver_old: Old version string
            ver_new: New version string

        Returns:
            An integer representing the relativity of the two version strings.
            0 means the two versions are equal,
            1 means new_ver is newer than old_ver (or there is no old_ver), and
            -1 means new_ver is older than old_ver.

        This method compares two version strings and determines which is older,
        which is newer, or if they are equal. Note that this method converts
        only the first three parts of a semantic version string
        (https://semver.org/).
        """

        # test for new install (don't try to regex)
        if ver_old == "":
            return 1

        # test for equal (just save some cpu cycles)
        if ver_old == ver_new:
            return 0

        # compare version string parts (only x.x.x)
        res_old = re.search(self.R_VERSION, ver_old)
        res_new = re.search(self.R_VERSION, ver_new)

        # if both version strings are valid
        if res_old and res_new:

            # make a list of groups to check
            lst_groups = [
                self.R_VERSION_GROUP_MAJ,
                self.R_VERSION_GROUP_MIN,
                self.R_VERSION_GROUP_REV,
            ]

            # for each part as int
            for group in lst_groups:
                old_val = int(res_old.group(group))
                new_val = int(res_new.group(group))

                # slide out at the first difference
                if old_val &lt; new_val:
                    return 1
                elif old_val &gt; new_val:
                    return -1
                else:
                    continue
        else:
            raise OSError(self.S_ERR_VERSION)

        # return 0 if equal
        return 0</code></pre>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="install.install.CNInstall.__init__" class="doc doc-heading">
            <code class="highlight language-python">__init__()</code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialize the class</p>
<p>Creates a new instance of the object and initializes its properties.</p>


            <details class="quote">
              <summary>Source code in <code>install/install.py</code></summary>
              <pre class="highlight"><code class="language-python">def __init__(self):
    """
    Initialize the class

    Creates a new instance of the object and initializes its properties.
    """

    # set arg properties
    self._dict_args = {}
    self._dry_run = False

    # project stuff
    # NB: set to path objects to avoid comparing to None
    self._dir_assets = Path()
    self._dir_usr_inst = Path()
    self._path_cfg_inst = Path()
    self._path_cfg_uninst = Path()
    self._dir_venv = Path()
    self._path_reqs = Path()
    self._file_desk = Path()
    self._file_desk_icon = Path()

    # config stuff
    self._dict_cfg = {}

    # cmd line stuff
    # NB: placeholder to avoid comparing to None
    self._parser = argparse.ArgumentParser()</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="install.install.CNInstall.main" class="doc doc-heading">
            <code class="highlight language-python">main(dir_assets, dir_usr_inst, path_cfg_inst, path_cfg_uninst, dir_venv, path_reqs, file_desk=None, file_desk_icon=None)</code>

</h3>


    <div class="doc doc-contents ">

        <p>Install the program</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>dir_assets</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the assets folder where all of the program</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dir_usr_inst</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The program's install folder in which to place files</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_cfg_inst</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the file that contains the current install</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_cfg_uninst</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the currently installed program's</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dir_venv</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path to the venv folder to create</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_reqs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the requirements.txt file to add requirements to</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>file_desk</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the .desktop file (if GUI) (default: None)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>file_desk_icon</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the .desktop file icon (if GUI) (default:</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Runs the install operation.</p>


            <details class="quote">
              <summary>Source code in <code>install/install.py</code></summary>
              <pre class="highlight"><code class="language-python">def main(
    self,
    dir_assets,
    dir_usr_inst,
    path_cfg_inst,
    path_cfg_uninst,
    dir_venv,
    path_reqs,
    file_desk=None,
    file_desk_icon=None,
):
    """
    Install the program

    Args:
        dir_assets: Path to the assets folder where all of the program
        files are put in dist. This is the base source path to use when
        copying files to the user's computer
        dir_usr_inst: The program's install folder in which to place files
        path_cfg_inst: Path to the file that contains the current install
        dict info
        path_cfg_uninst: Path to the currently installed program's
        uninstall dict info
        dir_venv: The path to the venv folder to create
        path_reqs: Path to the requirements.txt file to add requirements to
        the venv
        file_desk: Path to the .desktop file (if GUI) (default: None)
        file_desk_icon: Path to the .desktop file icon (if GUI) (default:
        None)

    Runs the install operation.
    """

    # set props from params
    if dir_assets:
        dir_assets = Path(dir_assets)
        if not dir_assets.is_absolute():
            # make abs rel to self
            dir_assets = P_DIR_PRJ / dir_assets
    self._dir_assets = dir_assets

    if dir_usr_inst:
        dir_usr_inst = Path(dir_usr_inst)
        if not dir_usr_inst.is_absolute():
            # make abs rel to self
            dir_usr_inst = self._dir_assets / dir_usr_inst
    self._dir_usr_inst = dir_usr_inst

    if path_cfg_inst:
        path_cfg_inst = Path(path_cfg_inst)
        if not path_cfg_inst.is_absolute():
            # make abs rel to self
            path_cfg_inst = self._dir_assets / path_cfg_inst
    self._path_cfg_inst = path_cfg_inst

    if path_cfg_uninst:
        path_cfg_uninst = Path(path_cfg_uninst)
        if not path_cfg_uninst.is_absolute():
            # make abs rel to self
            path_cfg_uninst = self._dir_assets / path_cfg_uninst
    self._path_cfg_uninst = path_cfg_uninst

    if dir_venv:
        dir_venv = Path(dir_venv)
        if not dir_venv.is_absolute():
            # make abs rel to self
            dir_venv = self._dir_assets / dir_venv
    self._dir_venv = dir_venv

    if path_reqs:
        path_reqs = Path(path_reqs)
        if not path_reqs.is_absolute():
            # make abs rel to self
            path_reqs = self._dir_assets / path_reqs
    self._path_reqs = path_reqs

    if file_desk:
        file_desk = Path(file_desk)
        if not file_desk.is_absolute():
            # make abs rel to self
            file_desk = self._dir_assets / file_desk
    self._file_desk = file_desk

    if file_desk_icon:
        file_desk_icon = Path(file_desk_icon)
        if not file_desk_icon.is_absolute():
            # make abs rel to self
            file_desk_icon = self._dir_assets / file_desk_icon
    self._file_desk_icon = file_desk_icon

    # ----------------------------------------------------------------------

    # do setup
    self._setup()

    # parse cmd line and get args
    self._do_cmd_line()

    # get prj info from cfg
    self._get_project_info()

    # check for existing/old version
    self._check_ver()

    # make the venv on the user's comp
    self._make_venv()

    # install reqs
    self._install_reqs()

    # fix desktop file if present
    self._fix_desktop_file()

    # move content
    self._install_content()

    # wind down
    self._teardown()</code></pre>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../../js/base.js"></script>
        <script src="../../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
